---
title: "Fit Bit Data Analyses"
output:
  html_document:
    df_print: paged
---
## ASK
### Business Task
We will analyze smart device usage data in order to gain insight into how consumers use non-Bellabeat smart devices.In the end, we will use one Bellabeat product to apply these insights to in a presentation. 

### key stakeholders
- Urška Sršen: Bellabeat’s cofounder and Chief Creative Officer
- Sando Mur: Mathematician and Bellabeat’s cofounder; key member of the Bellabeat executive team
- Bellabeat marketing analytics team

### Data Source

We will use the  publicly available FitBit Fitness Tracker Data from Kaggle, made avalble by Mobios to carry out this analyses.
This Analyses should be able to provide us with valuable insite into the FitBit industry and at the end help us to improve our product and/or understand the market better.

## Prepare
I will begin my annalyses by loading the relevant packages required by R to do this job. This libraries include:
```{r}
 install.packages("tidyverse")
install.packages("highcharter")
install.packages("ggplot2")
library(tidyverse)
library(ggplot2) #For Basic graphs
library(scales)   # For transforming numbers in percentage
library(highcharter) # Cool and interactive graphs
library(RColorBrewer)  # Pallete colors
```
### Loading Relevant Data to our Annalyses
I am interested in the correlations between Daily Activity, Sleep and Weight.
So I will load in the corresponding datasets that will help me acheive this.

Some of the tables within the Data set are found in the dailyActivity table and hence it will be pointless loading them here.
```{r}
daily_activity <- read_csv("Documents/Google_Data_Analyses_With_R/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
sleep_day <- read_csv("Documents/Google_Data_Analyses_With_R/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
weight_log <- read_csv("Documents/Google_Data_Analyses_With_R/Fitabase Data 4.12.16-5.12.16/weightLogInfo_merged.csv")
```
## Process
### Summary Analyses and view of our Loaded Data 
 
```{r Distinct Users}
n_distinct(daily_activity$Id)
n_distinct(sleep_day$Id)
n_distinct(weight_log$Id)

```
```{r summary of my data}
daily_activity %>%  
  select(TotalSteps,
         TotalDistance,
         SedentaryMinutes,
         Calories) %>%
  summary()

```

```{r}
sleep_day %>%  
  select(TotalSleepRecords,
  TotalMinutesAsleep,
  TotalTimeInBed) %>%
  summary()
```
```{r}
weight_log %>%  
  select(WeightKg,
  WeightPounds,
  BMI) %>%
  summary()
```
*Cleaning the Data
We will rename some of the variables to make them uniform accross the tables and hence easier to merge or create joins

```{r}
daily_activity <- daily_activity %>% 
  rename(Date = ActivityDate) %>% 
  mutate(Date = as.Date(Date, format = "%m/%d/%y"))

sleep_day <- sleep_day %>% 
  rename(Date = SleepDay) %>% 
  mutate(Date = as.Date(Date, format = "%m/%d/%y"))

weight_log <- weight_log %>% 
  select(-LogId) %>% 
  mutate(Date = as.Date(Date, format = "%m/%d/%y")) %>% 
  mutate(IsManualReport = as.factor(IsManualReport))
```

### Ploting some of the data in our set to futher explore relationships

```{r ploting Relationship betweem tatal steps and calories lossed}
ggplot(data=daily_activity, aes(x=TotalSteps, y=Calories, color=Calories), Position("jitter")) + geom_point()+ labs(title = "Correllation Between Total Steps and Calories Burned", subtitle = "Number of steps per day vs calories lossed")
```
There is a positive correlation between total Total Steps and Calories lost.

```{r Relstionship Between Total sleep and Sedentary Minutes}
ggplot(data=daily_activity, aes(x=TotalSteps, y=SedentaryMinutes, color=TotalSteps)) + geom_point()
```


### Merging the three Tables 

This will enable us find a relationship between Activity, Sleep, Weight and other trends.
```{r}
combined_df <- merge(merge(daily_activity, sleep_day, by = c('Id', 'Date'), all = TRUE), weight_log, by = c('Id', 'Date'), all = TRUE)


n_distinct(combined_df)
```
Lets find out how the new data looks like

```{r}
head(combined_df)
```
### Further Cleaninng
We wont be needing all the columns or data in our table, so we will clean those that are not usefull to us now in our new table.

```{r}
combined_df <- combined_df %>% select(-c(TrackerDistance, LoggedActivitiesDistance, TotalSleepRecords, WeightPounds, Fat, BMI, IsManualReport))

```

## A Summary of our New Table
This will provide us some useful statistical informations on our data
```{r}
summary(combined_df)

```
## Analyze
We will now go into the merged data and do some annalyses.

```{r}
custom_theme <- function() {
  theme(
    panel.border = element_rect(colour = "black", 
                                fill = NA, 
                                linetype = 1),
    panel.background = element_rect(fill = "white", 
                                    color = 'grey50'),
    panel.grid.minor.y = element_blank(),
    axis.text = element_text(colour = "#787878", 
                             face = "italic", 
                             family = "Helvetica"),
    axis.title = element_text(colour = "#6C7A89", 
                              family = "Helvetica"),
    axis.ticks = element_line(colour = "#6C7A89"),
    plot.title = element_text(size=23, 
                              hjust = 0.5, 
                              family = "Helvetica"),
    plot.subtitle=element_text(size=16, 
                               hjust = 0.5),
    plot.caption = element_text(colour = "#6C7A89", 
                             face = "italic", 
                             family = "Helvetica")
  )
} #This is the theme we will use all through for our plots to help us have  clean plots
```
### Relationship Between Calories bruned and Steps
We will use a point graph
```{r}
combined_df%>%
  group_by(TotalSteps, Calories)%>%
  ggplot(aes(x = TotalSteps, y = Calories, color = Calories)) +
  geom_point() +
  geom_smooth() + 
  custom_theme() +
  theme(legend.position = c(.8, .3),
        legend.spacing.y = unit(1, "mm"), 
        panel.border = element_rect(colour = "black", fill=NA),
        legend.background = element_blank(),
        legend.box.background = element_rect(colour = "black")) +
  labs(title = 'Calories burned with total steps taken',
       y = 'Calories',
       x = 'Total Steps',
       caption = 'Data Source: FitBit Fitness Tracker Data')
```
This confirrmst the previous assumption we made from the first plot we did above.
A more statistical confirmation will be us using the Pearson Correlation Coefficient. to find out elements like the P value
```{r}
cor.test(combined_df$TotalSteps, combined_df$Calories, method = 'pearson', conf.level = 0.95)

```
There is clearly a strong relationship between the variables, given that at a a confidence level of 95%, the correlation between the variables is almost 0.6

### The Users Daily Activity
```{r}
combined_df %>% 
  mutate(weekdays = weekdays(Date)) %>% 
  select(weekdays, TotalSteps) %>% 
  mutate(weekdays = factor(weekdays, levels = c('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'))) %>% 
  drop_na() %>% 
  ggplot(aes(weekdays, TotalSteps, fill = weekdays)) +
  geom_boxplot() +
  custom_theme() +
  scale_fill_brewer(palette="Set6") +
  theme(legend.position="none") +
  labs(
    title = "Users' activity by day",
    x = "Day of the week",
    y = "Steps",
    caption = 'Data Source: FitBit Fitness Tracker Data'
  )
```
The Box Plot does not show that there is much difference between the days.
We will further look into the intensity within the days.
### Intensity of Daily Activities
```{r}
combined_df %>% 
  select(VeryActiveDistance, 
         ModeratelyActiveDistance, 
         LightActiveDistance) %>% 
  summarise(across(everything(), list(sum))) %>% 
  gather(activities, value) %>% 
  mutate(ratio = value / sum(value),
         label = percent(ratio %>% round(4))) %>% 
mutate(activities = factor(activities, 
                          labels = c('Light Activity','Moderate Activity', 'Heavy Activity'))) %>% 
  ggplot(aes(x = (activities), 
             y = value, 
             label = label, 
             fill = activities)) +
  geom_bar(stat='identity') +
  geom_label(aes(label = label), 
             fill = "beige", 
             colour = "black",
             vjust = 0.5) +
  custom_theme() +
  scale_fill_brewer(palette="seq4") +
  theme(legend.position="none") +
  labs(
    title = "Intensity of daily exercise activity",
    x = "Activity level",
    y = "Distance",
    caption = 'Data Source: FitBit Fitness Tracker Data'
  )
```
### How Active are the Users Days?
The *highcharter* will be a good package for this interactive *piechart*
```{r}
combined_df %>% 
  select(VeryActiveMinutes, 
         FairlyActiveMinutes, 
         LightlyActiveMinutes, 
         SedentaryMinutes) %>% 
  summarise(across(everything(), list(sum))) %>% 
  gather(active_level, minutes) %>% 
  mutate(active_level = factor(active_level, 
                          labels = c('Moderate Activity','Light Activity',
                                     'Sedentary','Heavy Activity'))) %>% 
  hchart('pie', hcaes(x = active_level, y = minutes)) %>% 
  hc_title(text = "Daily activity level in minutes",
           style = list(fontFamily = "Helvetica", fontSize = "35px"),
           align = "center") %>% 
  hc_tooltip(pointFormat = "<b>Value:</b> {point.y} <br>
                 <b>Percentage</b> {point.percentage:,.2f}%") %>%
  hc_credits(
    enabled = TRUE, 
    text = "<em>Data Source: FitBit Fitness Tracker Data</em></span>",
    style = list(fontSize = "14px", color = '#6C7A89',type = "spline")
    ) 
```
### How Is Their Sleep Distribution

```{r}
combined_df %>% 
  select(TotalMinutesAsleep) %>% 
  drop_na() %>% 
  mutate(sleep_quality = ifelse(TotalMinutesAsleep <= 420, 'Less than 7h',
                         ifelse(TotalMinutesAsleep <= 540, '7h to 9h', 
                         'More than 9h'))) %>%
  mutate(sleep_quality = factor(sleep_quality, 
                          levels = c('Less than 7h','7h to 9h',
                                     'More than 9h'))) %>% 
  ggplot(aes(x = TotalMinutesAsleep, fill = sleep_quality)) +
  geom_histogram(position = 'dodge', bins = 30) +
  custom_theme() +
  scale_fill_manual(values=c("blue", "green", "red")) +
  theme(legend.position = c(.80, .80),
        legend.title = element_blank(),
        legend.spacing.y = unit(0, "mm"), 
        panel.border = element_rect(colour = "black", fill=NA),
        legend.background = element_blank(),
        legend.box.background = element_rect(colour = "black")) +
  labs(
    title = "Sleep distribution",
    x = "Time slept (minutes)",
    y = "Count",
    caption = 'Data Source: FitBit Fitness Tracker Data'
  )
```
### Relationship Between Weight and Distance covered

```{r}
combined_df %>% 
  select(Id, WeightKg, TotalDistance) %>% 
  group_by(Id) %>% 
  summarise_all(list(~mean(., na.rm=TRUE))) %>% 
  drop_na() %>% 
  mutate(Id = factor(Id)) %>% 
  ggplot(aes(WeightKg, TotalDistance, fill = Id)) +
  geom_point(aes(color = Id, size = WeightKg), alpha = 0.5) +
  scale_size(range = c(5, 20)) +
  custom_theme() +
  theme(legend.position = "none") +
  labs(
    title = "Weight (kg) vs distance covered",
    x = "Weight (kg)",
    y = "Total Distance (Miles)",
    caption = 'Data Source: FitBit Fitness Tracker Data'
  )

```
### Steps and Sleep
We will also use the highcharter here to get a more slick visualization
```{r}
combined_df %>% 
  mutate(no_sleeping = TotalTimeInBed - TotalMinutesAsleep) %>% 
  select(Id, no_sleeping, TotalSteps) %>% 
  group_by(Id) %>% 
  summarise_all(list(~mean(., na.rm=TRUE))) %>%
  drop_na() %>% 
  mutate(Id = factor(Id)) %>% 
  hchart('scatter', hcaes(x = TotalSteps, y = no_sleeping, group = Id, showInLegend = T)) %>% 
  hc_title(text = "Dificulty to sleep vs steps taken",
           style = list(fontFamily = "Helvetica", fontSize = "35px"),
           align = "center") %>% 
  hc_legend(enabled = ) %>% 
  hc_yAxis(title = list(text = 'Time in bed not asleep (minutes)')) %>% 
  hc_xAxis(title = list(text = 'Steps')) %>% 
  hc_credits(
    enabled = TRUE, 
    text = "<em>Data Source: FitBit Fitness Tracker Data</em></span>",
    style = list(fontSize = "14px", color = '#6C7A89',type = "spline")
    ) 
```

## hare
### Some Suggestions for Our Stakeholders

The analyses show that the more steps taken per day. the more Calories are lost. This shows a clear correlation. We can encourage potential clients who are interested in weight loss to purchase the Leaf and Time gadgets in order to track their daily steps and calories loss 

Bellabeat can, with the sleep time analyses as well as the activity time, suggest activities as well as sleep scheduling for clients to better their wellness using their aps through specialized adverts and notifications.

Bellabeats, can through its notifications and ads suggest the correlation between sleep and level of Activity, by suggesting activity levels of less than 10,000 steps
 
### Further Analyses
I will export the new combined and cleaned Data to Tableau to Make other beautiful visuals, just for the sake of activity
```{r}
write.csv(combined_df,"/Users/hit54studios/Documents/Google_Data_Analyses_With_R\\fitbit_cleaned_combined_df.csv", row.names = FALSE)
```




